<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin ‚Äî Taxonomy Management | Trader Route</title>

  <!-- üåê SEO -->
  <meta name="description" content="Admin panel to manage categories and countries for Trader Route. Easily update and export JSON data files for global trade listings.">
  <meta name="keywords" content="Trader Route, admin, taxonomy, categories, countries, global trade, management, JSON editor">
  <meta name="author" content="Trader Route">
  <link rel="canonical" href="https://traderroute.com/admin/admin-taxonomy.html" />

  <!-- ‚ö° Performance -->
  <link rel="icon" href="../assets/logos.png" type="image/png" />
  <link rel="preload" href="../assets/logos.png" as="image" />

  <style>
    :root {
      --brand-green: #008b6a;
      --brand-dark: #006b52;
      --light-bg: #f8f9fa;
    }

    body {
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      margin: 0;
      background: var(--light-bg);
      color: #222;
    }

    header {
      background: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    header img { height: 46px; }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-text {
      font-size: 15px;
      color: #555;
      font-weight: 500;
    }

    nav a {
      margin: 0 14px;
      text-decoration: none;
      color: #222;
      font-weight: 500;
      transition: color 0.25s ease;
    }

    nav a:hover { color: var(--brand-green); }

    .search-box {
      display: flex;
      align-items: center;
      background: #f1f1f1;
      border-radius: 20px;
      padding: 5px 10px;
    }

    .search-box input {
      border: none;
      background: none;
      outline: none;
      padding: 5px;
      font-size: 14px;
      width: 150px;
    }

    .login-btn, .join-btn {
      border: none;
      cursor: pointer;
      border-radius: 6px;
      font-weight: 500;
      transition: 0.25s;
    }

    .login-btn {
      background: #f1f1f1;
      padding: 7px 14px;
    }

    .login-btn:hover { background: #e0e0e0; }

    .join-btn {
      background: var(--brand-green);
      color: #fff;
      padding: 8px 15px;
    }

    .join-btn:hover { background: var(--brand-dark); }

    .wrap {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    h1 { margin-bottom: 8px; color: var(--brand-green); }
    .subtitle { color: #666; margin-bottom: 24px; }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    @media(max-width:900px){ .grid{ grid-template-columns: 1fr; } }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border: 1px solid #eaeaea;
    }

    .card h2 { margin-top: 0; color: var(--brand-green); }
    .muted { color: #777; font-size: 13px; }

    .tools {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0 16px;
    }

    .btn {
      background: var(--brand-green);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 9px 14px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.25s;
    }
    .btn:hover { background: var(--brand-dark); }
    .btn.secondary { background: #f1f1f1; color: #222; }
    .btn.secondary:hover { background: #e6e6e6; }
    .btn.warn { background: #ef4444; }
    .btn.warn:hover { background: #c63737; }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin: 10px 0;
    }

    .row input[type="text"] {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }

    .list {
      border: 1px solid #eee;
      border-radius: 10px;
      max-height: 400px;
      overflow: auto;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #f2f2f2;
    }

    .item:last-child { border-bottom: none; }
    .item .name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    footer {
      text-align: center;
      padding: 25px;
      color: #777;
      border-top: 1px solid #ddd;
      margin-top: 40px;
      background: #fff;
    }

    .success {
      position: fixed;
      right: 25px;
      bottom: 25px;
      background: var(--brand-green);
      color: #fff;
      padding: 12px 18px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      opacity: 0;
      pointer-events: none;
      transition: 0.4s;
      font-weight: 500;
    }

    .success.show { opacity: 1; pointer-events: auto; }
  </style>
</head>

<body>
  <!-- HEADER -->
  <header>
    <div class="logo-container">
      <img src="../assets/logos.png" alt="Trader Route Logo" loading="lazy" />
      <span class="logo-text">The Silk Road of E-Commerce</span>
    </div>
    <nav>
      <a href="../index.html">Home</a>
      <a href="../companies.html">Companies</a>
      <a href="../requests.html">Requests</a>
      <a href="../contact.html">Contact</a>
      <a href="../pricing.html">Pricing</a>
    </nav>
    <div style="display:flex;align-items:center;gap:10px;">
      <div class="search-box">
        <input type="text" placeholder="Search..." />
        <button style="background:none;border:none;cursor:pointer;">üîç</button>
      </div>
      <button class="login-btn" onclick="location.href='../login.html'">Sign In</button>
      <button class="join-btn" onclick="location.href='../register.html'">Join Now</button>
    </div>
  </header>

  <!-- MAIN -->
  <div class="wrap">
    <h1>Taxonomy Manager</h1>
    <div class="subtitle">
      Manage your <strong>Categories</strong> and <strong>Countries</strong> lists.<br>
      Load from <code>/data</code>, edit, and export JSON files easily.
    </div>

    <div class="grid">
      <section class="card">
        <h2>Categories</h2>
        <div class="muted">File: data/categories.json</div>
        <div class="tools">
          <button class="btn secondary" onclick="importJson('#catFile','categories')">Import JSON</button>
          <input id="catFile" type="file" accept="application/json" style="display:none">
          <button class="btn" onclick="fetchRemote('categories')">Load from /data</button>
          <button class="btn" onclick="exportJson('categories')">Download JSON</button>
          <button class="btn secondary" onclick="sortList('categories')">Sort A‚ÄìZ</button>
          <button class="btn warn" onclick="clearAll('categories')">Clear All</button>
        </div>
        <div class="row">
          <input id="catInput" type="text" placeholder="Add new category..." />
          <button class="btn" onclick="addItem('categories')">Add</button>
        </div>
        <div id="catList" class="list"></div>
      </section>

      <section class="card">
        <h2>Countries</h2>
        <div class="muted">File: data/countries.json</div>
        <div class="tools">
          <button class="btn secondary" onclick="importJson('#countryFile','countries')">Import JSON</button>
          <input id="countryFile" type="file" accept="application/json" style="display:none">
          <button class="btn" onclick="fetchRemote('countries')">Load from /data</button>
          <button class="btn" onclick="exportJson('countries')">Download JSON</button>
          <button class="btn secondary" onclick="sortList('countries')">Sort A‚ÄìZ</button>
          <button class="btn warn" onclick="clearAll('countries')">Clear All</button>
        </div>
        <div class="row">
          <input id="countryInput" type="text" placeholder="Add new country..." />
          <button class="btn" onclick="addItem('countries')">Add</button>
        </div>
        <div id="countryList" class="list"></div>
      </section>
    </div>
  </div>

  <div id="toast" class="success">Saved</div>
  <footer>¬© 2025 Trader Route ‚Äî Admin Dashboard</footer>

  <script>
    // === Base path detect ===
    const DATA_BASE = location.pathname.includes('/admin/') ? '../data/' : 'data/';
    const state = { categories: [], countries: [] };
    const el = (s) => document.querySelector(s);

    function showToast(msg='Saved') {
      const t = el('#toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 1800);
    }

    const sanitize = (v) => String(v||'').trim();
    const dedupe = (arr) => [...new Set(arr.map(v => v.toLowerCase()))]
      .map(lower => arr.find(a => a.toLowerCase() === lower));

    function renderList(kind) {
      const list = el(kind==='categories' ? '#catList' : '#countryList');
      list.innerHTML='';
      const data = state[kind];
      if (!data.length) {
        list.innerHTML = '<div class="item"><div class="name muted">Empty</div></div>';
        return;
      }
      data.forEach((val, i)=>{
        const row = document.createElement('div');
        row.className='item';
        const name = document.createElement('div');
        name.className='name';
        name.textContent=val;
        const tools = document.createElement('div');
        tools.style.display='flex'; tools.style.gap='6px';
        const edit=document.createElement('button');
        edit.className='btn secondary'; edit.textContent='Edit';
        edit.onclick=()=>{
          const v=prompt('Edit:',val);
          if(v){ state[kind][i]=sanitize(v); state[kind]=dedupe(state[kind]).sort(); renderList(kind); showToast('Updated'); }
        };
        const del=document.createElement('button');
        del.className='btn warn'; del.textContent='Delete';
        del.onclick=()=>{
          if(confirm('Delete?')){ state[kind].splice(i,1); renderList(kind); showToast('Deleted'); }
        };
        tools.append(edit,del);
        row.append(name,tools);
        list.append(row);
      });
    }

    function addItem(kind){
      const inp = el(kind==='categories' ? '#catInput' : '#countryInput');
      const val = sanitize(inp.value);
      if(!val){alert('Value required');return;}
      state[kind].push(val); state[kind]=dedupe(state[kind]).sort(); inp.value=''; renderList(kind); showToast('Added');
    }

    function sortList(k){ state[k]=[...state[k]].sort(); renderList(k); showToast('Sorted'); }
    function clearAll(k){ if(confirm('Clear all?')){ state[k]=[]; renderList(k); showToast('Cleared'); } }

    async function fetchRemote(kind){
      const url = kind==='categories'?`${DATA_BASE}categories.json`:`${DATA_BASE}countries.json`;
      try{
        const res = await fetch(url,{cache:'no-store'});
        const arr = await res.json();
        if(!Array.isArray(arr)) throw new Error('Not array');
        state[kind]=dedupe(arr.map(sanitize)).sort();
        renderList(kind);
        showToast('Loaded from /data');
      }catch(e){ alert('Error: '+e.message); }
    }

    function importJson(fileSel,kind){
      const inp = el(fileSel);
      inp.value='';
      inp.onchange=(ev)=>{
        const f=ev.target.files[0];
        if(!f) return;
        const r=new FileReader();
        r.onload=()=>{
          try{
            const arr=JSON.parse(r.result);
            if(!Array.isArray(arr)) throw new Error('Invalid format');
            state[kind]=dedupe(arr.map(sanitize)).sort();
            renderList(kind); showToast('Imported');
          }catch(e){ alert(e.message); }
        };
        r.readAsText(f);
      };
      inp.click();
    }

    function exportJson(kind){
      const blob=new Blob([JSON.stringify(state[kind],null,2)],{type:'application/json'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download=kind==='categories'?'categories.json':'countries.json';
      a.click();
      URL.revokeObjectURL(a.href);
      showToast('Downloaded');
    }

    fetchRemote('categories');
    fetchRemote('countries');
  </script>
</body>
</html>
