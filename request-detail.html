<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Request Detail — Trader Route</title>
<link rel="icon" href="assets/logos.png" type="image/png">
<style>
body{font-family:"Segoe UI",sans-serif;background:#f8f9fa;margin:0;padding:20px;}
.container{max-width:800px;margin:auto;background:#fff;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
h2{color:#008d62;}
small{color:#777;}
textarea,input{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-top:8px;}
button{margin-top:10px;background:#008d62;color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;}
button:hover{background:#006b4a;}
</style>
</head>
<body>

<div class="container">
  <h2 id="title"></h2>
  <small id="meta"></small>
  <p id="desc" style="margin-top:15px;"></p>

  <h3>Contact Seller / Buyer</h3>
  <textarea id="messageBox" placeholder="Write your message..." required></textarea><br>
  <button onclick="sendMessage()">Send Message</button>
  <p id="status"></p>
</div>

<script>
async function loadDetail() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const res = await fetch("data/requests.json");
  const data = await res.json();
  const item = data[id];
  document.getElementById("title").innerText = item.title;
  document.getElementById("meta").innerText = `${item.country} • ${item.category} • ${item.type}`;
  document.getElementById("desc").innerText = item.description;
  window.requestItem = item;
}

async function sendMessage() {
  const item = window.requestItem;
  const sender = prompt("Please enter your email:");
  const msg = document.getElementById("messageBox").value;
  if(!sender || !msg){alert("Please fill out message and email");return;}

  // 1️⃣ E-posta gönder
  await fetch(`https://formsubmit.co/ajax/${item.email}`, {
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name:sender,message:msg,_subject:`New message about: ${item.title}`})
  });

  // 2️⃣ Mesaj kaydet
  const msgRes = await fetch("data/messages.json");
  const messages = await msgRes.json();
  messages.push({to:item.email,from:sender,text:msg,date:new Date().toISOString(),requestTitle:item.title});
  await fetch("data/messages.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(messages,null,2)});
  document.getElementById("status").innerText="✅ Message sent and saved!";
  document.getElementById("messageBox").value="";
}
loadDetail();
</script>
</body>
</html>
