<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trader Route ‚Äì Requests</title>

  <!-- ‚úÖ SEO META -->
  <meta name="description" content="Explore global buy and sell requests on Trader Route. Filter by category and country to find real B2B opportunities worldwide." />
  <meta name="keywords" content="Trader Route, requests, buy, sell, B2B, marketplace, global trade, import, export" />
  <meta name="author" content="Trader Route" />
  <link rel="canonical" href="https://traderroute.com/requests.html" />
  <link rel="icon" href="assets/logos.png" />

  <!-- (Varsa senin stil dosyan aynƒ± kalƒ±r) -->
  <link rel="stylesheet" href="style.css" />

  <style>
    /* üîí Orijinal yapƒ± korunur; sadece gerekli ufak eklemeler */
    :root{ --green:#008b6a; --green-dark:#006b52; --light:#f6f8fa; }

    body { font-family:"Inter","Segoe UI",Arial,sans-serif; margin:0; background:var(--light); color:#222; }

    /* Header (ekleme) */
    header{
      display:flex; align-items:center; justify-content:space-between;
      background:#fff; padding:12px 20px; border-bottom:1px solid #ddd;
      box-shadow:0 2px 4px rgba(0,0,0,0.05); position:sticky; top:0; z-index:1000;
    }
    header .brand{display:flex; align-items:center; gap:10px;}
    header img{height:50px; cursor:pointer;}
    header .tagline{font-size:14px; color:#555; font-weight:600;}
    nav a{margin:0 10px; text-decoration:none; color:#333; font-weight:600;}
    nav a:hover{color:var(--green);}
    .right{display:flex; align-items:center; gap:10px;}
    .right .search{background:#f1f1f1; border-radius:20px; padding:5px 10px; display:flex; align-items:center;}
    .right .search input{border:none; background:none; outline:none; padding:5px; width:150px;}
    .btn-green{background:var(--green); color:#fff; border:none; border-radius:6px; padding:8px 14px; font-weight:600; cursor:pointer;}
    .btn-green:hover{background:var(--green-dark);}

    /* Tabs (Free Request eklendi; aktif sekme ye≈üil) */
    .tabs{display:flex; justify-content:center; background:#fff; border-bottom:1px solid #ddd; gap:10px; padding:14px 0;}
    .tabs button{background:none; border:none; font-weight:600; font-size:17px; padding:10px 24px; border-radius:25px; cursor:pointer; color:#333; transition:.2s;}
    .tabs button.active{background:var(--green); color:#fff;}
    .tabs button:hover{background:#f0f0f0;}

    /* Layout (senin orijinal container/sidebar/content isimleri varsa onlar korunur) */
    .container{max-width:1300px; margin:35px auto; display:flex; gap:24px; padding:0 15px;}
    .sidebar{width:300px; background:#fff; padding:22px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.06); display:flex; flex-direction:column;}
    .sidebar h4{font-size:19px; font-weight:700; color:#111; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:4px;}
    .category-search,.country-search{width:100%; padding:9px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:14px;}
    .category-list,.country-list{list-style:none; padding-left:0; margin:0; overflow-y:auto; scrollbar-width:thin; scrollbar-color:#ccc transparent; flex:1;}
    .category-list{max-height:260px; margin-bottom:20px;}
    .country-list{max-height:320px;}
    .category-list li,.country-list li{margin-bottom:6px;}
    .category-list a,.country-list a{display:flex; align-items:center; justify-content:space-between; text-decoration:none; color:#333; font-size:14px; gap:6px; padding:4px 3px; border-radius:5px; transition:.15s;}
    .category-list a:hover,.country-list a:hover{background:#f1f6ff; color:#007bff;}
    .count{color:#888; font-size:13px;}
    .flag{width:20px; height:14px; border:1px solid #ccc; border-radius:2px; margin-right:6px; object-fit:cover;}

    .content{flex:1; background:#fff; border-radius:12px; padding:30px; box-shadow:0 2px 6px rgba(0,0,0,0.06);}
    .search-bar{margin-bottom:20px;}
    #searchInput{width:100%; max-width:420px; padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;}

    .request-card{border:1px solid #e3e3e3; border-radius:8px; padding:15px; margin-bottom:15px; background:#fff; transition:.2s; cursor:pointer;}
    .request-card:hover{box-shadow:0 3px 10px rgba(0,0,0,0.08); transform:translateY(-2px);}
    .request-card h5{margin:0 0 6px; font-size:17px; font-weight:600;}
    .request-card p{margin:0 0 4px; font-size:14px; color:#444;}
    .request-card small{color:#666;}
    .msg-btn{background:var(--green); color:#fff; border:none; border-radius:5px; padding:6px 10px; font-size:13px; font-weight:600; cursor:pointer; margin-top:6px;}
    .msg-btn:hover{background:var(--green-dark);}

    #showMoreRequests{background:var(--green); color:#fff; border:none; border-radius:6px; padding:10px 15px; cursor:pointer; font-weight:600; margin:20px auto; display:block;}
    #showMoreRequests:hover{background:var(--green-dark);}

    @media(max-width:900px){
      .container{flex-direction:column}
      .sidebar{width:100%; order:2}
      .content{order:1}
    }
  </style>
</head>

<body>
  <!-- ‚úÖ HEADER (logo + tagline + men√º + arama + ye≈üil butonlar) -->
  <header>
    <div class="brand" onclick="location.href='index.html'">
      <img src="assets/logos.png" alt="Trader Route Logo" loading="lazy" />
      <span class="tagline">The Silk Road of E-Commerce</span>
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="companies.html">Companies</a>
      <a href="requests.html" style="color:var(--green);font-weight:700;">Requests</a>
      <a href="contact.html">Contact</a>
      <a href="pricing.html">Prices</a>
    </nav>
    <div class="right">
      <div class="search">
        <input type="text" id="hdrSearch" placeholder="Search..." />
        üîç
      </div>
      <button class="btn-green" onclick="location.href='free-request.html'">Free Request</button>
      <button class="btn-green" onclick="location.href='login.html'">Sign In</button>
      <button class="btn-green" onclick="location.href='register.html'">Sign Up</button>
    </div>
  </header>

  <!-- ‚úÖ Tabs (Free Request sekmesi eklendi) -->
  <div class="tabs">
    <button class="active" id="tabAll">All Requests</button>
    <button id="tabBuy">Buy Requests</button>
    <button id="tabSell">Sell Requests</button>
    <button id="tabFree" onclick="location.href='free-request.html'">Free Request</button>
  </div>

  <!-- ‚úÖ Orijinal iskelet korunur -->
  <div class="container">
    <div class="sidebar">
      <h4>Categories</h4>
      <input type="text" class="category-search" id="categorySearch" placeholder="Search category..." />
      <ul class="category-list" id="categoryList"></ul>

      <h4>Countries</h4>
      <input type="text" class="country-search" id="countrySearch" placeholder="Search country..." />
      <ul class="country-list" id="countryList"></ul>
    </div>

    <div class="content">
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search requests..." />
      </div>
      <div id="requestItems"></div>
      <button id="showMoreRequests">Show more requests</button>
    </div>
  </div>

  <script>
    /* ========= Mevcut veri/filtre yapƒ±n korunur ========= */
    // Eƒüer senin dosyanda categories & allCountries dizileri zaten varsa, onlarƒ± kullan.
    // Yoksa data/*.json'dan y√ºkle.
    let categories = (window.categories && Array.isArray(window.categories)) ? window.categories.slice() : null;
    let allCountries = (window.allCountries && Array.isArray(window.allCountries)) ? window.allCountries.slice() : null;

    const getRequests = () => JSON.parse(localStorage.getItem("requests") || "[]");

    const categoryList = document.getElementById("categoryList");
    const countryList = document.getElementById("countryList");
    const categorySearch = document.getElementById("categorySearch");
    const countrySearch = document.getElementById("countrySearch");
    const requestContainer = document.getElementById("requestItems");
    const showMoreBtn = document.getElementById("showMoreRequests");
    const searchInput = document.getElementById("searchInput");

    let visibleRequests = 15;
    let activeTab = "all";
    let selectedCategory = null;
    let selectedCountry = null;

    // URL parametreleri (orijinal davranƒ±≈ü)
    (function(){
      const params = new URLSearchParams(location.search);
      const urlCat = params.get("category");
      const urlCou = params.get("country");
      if (urlCat) selectedCategory = urlCat;
      if (urlCou) selectedCountry = urlCou;
    })();

    // === Yardƒ±mcƒ±lar ===
    const toCode = name => (name||"").slice(0,2).toLowerCase();
    const countryCodeMap = {
      "Turkey":"tr","United States":"us","Germany":"de","France":"fr","Italy":"it","Spain":"es","China":"cn","Japan":"jp",
      "India":"in","Brazil":"br","Russia":"ru","Canada":"ca","Australia":"au","United Kingdom":"gb","UK":"gb","Mexico":"mx"
    };

    async function ensureCategories(){
      if (categories) return;
      try{
        const res = await fetch('data/categories.json', {cache:'no-store'});
        const arr = await res.json();
        categories = Array.isArray(arr) ? arr.map(String) : [];
      }catch{ categories = []; }
    }

    async function ensureCountries(){
      if (allCountries) return;
      try{
        const res = await fetch('data/countries.json', {cache:'no-store'});
        const arr = await res.json();
        // arr: ["Turkey", ...] veya [{name:"Turkey", code:"tr"}, ...]
        allCountries = (arr||[]).map(it=>{
          if (typeof it === 'string') {
            const name = it;
            const code = (countryCodeMap[name] || toCode(name));
            return {name, code};
          } else {
            const name = String(it.name);
            const code = String(it.code||countryCodeMap[name]||toCode(name)).toLowerCase();
            return {name, code};
          }
        });
      }catch{ allCountries = []; }
    }

    // === Kategoriler (count korunur) ===
    function renderCategories(requests){
      const term = (categorySearch.value||'').toLowerCase();
      const data = (categories||[]).filter(c => c.toLowerCase().includes(term));
      categoryList.innerHTML = '';
      data.forEach(cat=>{
        const count = requests.filter(r => r.category === cat).length;
        const li = document.createElement('li');
        li.innerHTML = `<a href="#">${cat}<span class="count">(${count})</span></a>`;
        li.addEventListener('click', (e)=>{ e.preventDefault(); selectedCategory = cat; selectedCountry = null; renderRequests(); });
        categoryList.appendChild(li);
      });
    }

    // === √úlkeler (tam liste + scroll + count + lazy flag) ===
    function renderCountries(requests){
      const term = (countrySearch.value||'').toLowerCase();
      const data = (allCountries||[]).filter(c => c.name.toLowerCase().includes(term));
      countryList.innerHTML = '';
      data.forEach(c=>{
        const count = requests.filter(r => r.country === c.name).length;
        const li = document.createElement('li');
        li.innerHTML = `
          <a href="#">
            <span style="display:flex;align-items:center;gap:6px;">
              <img class="flag" src="https://flagcdn.com/h20/${c.code}.png" alt="${c.name}" loading="lazy">
              ${c.name}
            </span>
            <span class="count">(${count})</span>
          </a>`;
        li.addEventListener('click', (e)=>{ e.preventDefault(); selectedCountry = c.name; selectedCategory = null; renderRequests(); });
        countryList.appendChild(li);
      });
    }

    // === ƒ∞lanlar: tƒ±klanƒ±nca detay + Message butonu ===
    function renderRequests(){
      const allReq = getRequests();

      // Listenin √ºst√ºndeki sayacƒ± korumak i√ßin √∂nce listeleri g√ºncelle
      renderCategories(allReq);
      renderCountries(allReq);

      const term = (searchInput.value||'').toLowerCase();
      const filtered = allReq.filter(r =>
        (activeTab === 'all' || r.type === activeTab) &&
        (!selectedCategory || r.category === selectedCategory) &&
        (!selectedCountry || r.country === selectedCountry) &&
        ((r.title||'').toLowerCase().includes(term) || (r.description||'').toLowerCase().includes(term))
      );

      requestContainer.innerHTML = '';
      filtered.slice(0, visibleRequests).forEach(r=>{
        const div = document.createElement('div');
        div.className = 'request-card';

        // Kart tƒ±klanƒ±nca detay
        div.onclick = () => { window.location.href = `request-detail.html?id=${encodeURIComponent(r.id)}`; };

        const msgTo = r.ownerEmail || r.contactEmail || r.email || '';
        const msgBtn = msgTo
          ? `<button class="msg-btn" onclick="event.stopPropagation();window.location.href='messages.html?to=${encodeURIComponent(msgTo)}'">Message</button>`
          : '';

        div.innerHTML = `
          <h5>${r.title || ''}</h5>
          <p>${r.description || ''}</p>
          <small>${r.country || ''} ¬∑ ${r.category || ''}</small><br>
          ${msgBtn}
        `;
        requestContainer.appendChild(div);
      });

      showMoreBtn.style.display = filtered.length > visibleRequests ? 'block' : 'none';
    }

    // === Tabs ===
    document.getElementById('tabAll').onclick = ()=>{ setActive('tabAll'); activeTab='all'; renderRequests(); };
    document.getElementById('tabBuy').onclick = ()=>{ setActive('tabBuy'); activeTab='buy'; renderRequests(); };
    document.getElementById('tabSell').onclick = ()=>{ setActive('tabSell'); activeTab='sell'; renderRequests(); };
    function setActive(id){
      document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // === Show more ===
    showMoreBtn.onclick = ()=>{ visibleRequests += 10; renderRequests(); };

    // === Arama ===
    searchInput.addEventListener('input', renderRequests);
    categorySearch.addEventListener('input', renderRequests);
    countrySearch.addEventListener('input', renderRequests);

    // === Ba≈ülat ===
    (async function init(){
      await ensureCategories();
      await ensureCountries();
      renderRequests();
    })();
  </script>
</body>
</html>
