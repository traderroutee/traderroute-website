<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trader Route - Requests</title>

  <!-- Correct paths -->
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="assets/logo.png" />

  <style>
    body{font-family:Arial,sans-serif;background:#f5f6f8;margin:0}
    header{display:flex;align-items:center;background:#fff;padding:10px 20px;border-bottom:1px solid #ddd}
    header img{height:50px;cursor:pointer}

    .tabs{display:flex;justify-content:center;background:#fff;border-bottom:1px solid #ddd;gap:10px;padding:10px 0}
    .tabs button{background:none;border:none;font-weight:600;font-size:16px;padding:8px 20px;border-radius:25px;cursor:pointer;transition:.2s}
    .tabs button.active{background:#007bff;color:#fff}

    .container{max-width:1200px;margin:30px auto;display:flex;gap:20px;padding:0 15px}
    .sidebar{width:280px;background:#fff;padding:20px;border-radius:10px;overflow-y:auto;max-height:80vh}
    .sidebar h4{margin-bottom:10px;color:#222}
    .category-list,.country-list{list-style:none;padding-left:0;margin:0 0 15px 0}
    .category-list li,.country-list li{margin-bottom:8px}
    .category-list a,.country-list a{display:flex;justify-content:space-between;text-decoration:none;color:#333}
    .category-list a:hover,.country-list a:hover{color:#007bff}
    .count{color:#888;font-size:.9em}

    .country-search{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;margin-bottom:10px}
    #showMoreCountries{display:block;width:100%;padding:8px;border:none;background:#007bff;color:#fff;border-radius:6px;margin-top:10px;cursor:pointer;font-size:14px}
    #showMoreCountries:hover{background:#0056b3}
    .clear-filters{background:#f8f9fa;border:1px solid #ccc;border-radius:6px;padding:6px 10px;margin-top:10px;cursor:pointer;font-size:13px}
    .clear-filters:hover{background:#eaeaea}

    .content{flex:1;background:#fff;border-radius:10px;padding:20px}
    .search-bar{margin-bottom:20px}
    #searchInput{width:100%;max-width:400px;padding:10px;border-radius:6px;border:1px solid #ccc}

    .request-card{border:1px solid #e3e3e3;border-radius:8px;padding:15px;margin-bottom:15px;background:#fff;transition:.2s;cursor:pointer}
    .request-card:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .request-card h5{margin:0 0 5px}
    .request-card small{color:#666}

    #showMoreRequests{background:#007bff;color:#fff;border:none;border-radius:6px;padding:10px 15px;cursor:pointer;font-weight:600;margin:20px auto;display:block}
    #showMoreRequests:hover{background:#0056b3}

    @media(max-width:768px){
      .container{flex-direction:column}
      .sidebar{width:100%;max-height:none}
      .tabs{flex-wrap:wrap}
    }
  </style>
</head>
<body>
  <!-- Logo (left) -->
  <header>
    <a href="index.html"><img src="assets/logos.png" alt="Trader Route Logo"></a>
  </header>

  <!-- Tabs -->
  <div class="tabs">
    <button class="active" id="tabAll">All Requests</button>
    <button id="tabBuy">Buy Requests</button>
    <button id="tabSell">Sell Requests</button>
  </div>

  <div class="container">
    <!-- Left: filters -->
    <aside class="sidebar">
      <h4>Categories</h4>
      <ul id="categoryList" class="category-list"></ul>

      <h4>Countries</h4>
      <input id="countrySearch" class="country-search" placeholder="Search country..." />
      <ul id="countryList" class="country-list"></ul>
      <button id="showMoreCountries">Show more countries</button>

      <button id="clearFilters" class="clear-filters">Clear Filters</button>
    </aside>

    <!-- Right: results -->
    <main class="content">
      <div class="search-bar">
        <input id="searchInput" placeholder="Search requests..." />
      </div>
      <div id="requestItems"></div>
      <button id="showMoreRequests">Show more requests</button>
    </main>
  </div>

  <script>
    /* ---------- Data ---------- */
    var categories = [
      "Agriculture","Apparel","Automobiles & Motorcycles","Beauty & Personal Care",
      "Business Services","Chemicals","Computer Hardware & Software","Construction & Real Estate",
      "Consumer Electronics","Electrical Equipment & Supplies","Electronic Components & Supplies",
      "Energy","Environment","Fashion Accessories","Food & Beverage","Furniture",
      "Gifts & Crafts","Hardware","Health & Medical","Home & Garden","Home Appliances",
      "Lights & Lighting","Luggage, Bags & Cases","Machinery","Measurement & Analysis Instruments",
      "Minerals & Metallurgy","Office & School Supplies","Packaging & Printing","Rubber & Plastics",
      "Security & Protection","Service Equipment","Shoes & Accessories","Sports & Entertainment",
      "Telecommunications","Textiles & Leather Products","Tools","Toys & Hobbies","Transportation"
    ];

    var allCountries = [
      "Afghanistan","Albania","Algeria","Argentina","Australia","Austria","Bangladesh","Belgium","Brazil","Bulgaria",
      "Canada","Chile","China","Colombia","Czech Republic","Denmark","Egypt","Finland","France","Germany",
      "Greece","Hungary","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Japan",
      "Kenya","Kuwait","Lebanon","Malaysia","Mexico","Morocco","Netherlands","Nigeria","Norway","Pakistan",
      "Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia","Saudi Arabia","Singapore","South Africa",
      "South Korea","Spain","Sri Lanka","Sweden","Switzerland","Thailand","Turkey","Ukraine","United Arab Emirates","United Kingdom","United States"
    ];

    function getRequests(){
      try { return JSON.parse(localStorage.getItem("requests") || "[]"); }
      catch(e){ return []; }
    }

    /* ---------- Elements ---------- */
    var requestContainer = document.getElementById("requestItems");
    var searchInput = document.getElementById("searchInput");
    var categoryList = document.getElementById("categoryList");
    var countryList = document.getElementById("countryList");
    var clearFilters = document.getElementById("clearFilters");
    var showMoreCountriesBtn = document.getElementById("showMoreCountries");
    var countrySearch = document.getElementById("countrySearch");

    var tabs = {
      all: document.getElementById("tabAll"),
      buy: document.getElementById("tabBuy"),
      sell: document.getElementById("tabSell")
    };

    /* ---------- State ---------- */
    var visibleRequests = 15;
    var activeTab = "all";
    var selectedCategory = null;
    var selectedCountry = null;
    var visibleCountryCount = 10;

    /* ---------- Renderers ---------- */
    function renderCategories(requests){
      categoryList.innerHTML = "";
      // counts map
      var counts = {};
      for (var i=0;i<categories.length;i++){ counts[categories[i]] = 0; }
      for (var j=0;j<requests.length;j++){
        var c = requests[j].category;
        if (counts.hasOwnProperty(c)) counts[c] += 1;
      }
      // always show all categories (with 0)
      for (var k=0;k<categories.length;k++){
        var cat = categories[k];
        var li = document.createElement("li");
        li.innerHTML = '<a href="#">'+cat+'<span class="count">('+counts[cat]+')</span></a>';
        (function(catName){
          li.addEventListener("click", function(){
            selectedCategory = catName;
            visibleRequests = 15;
            renderRequests();
          });
        })(cat);
        categoryList.appendChild(li);
      }
    }

    function renderCountries(){
      countryList.innerHTML = "";
      var allReq = getRequests();
      // build counts
      var cCounts = {};
      for (var i=0;i<allCountries.length;i++){ cCounts[allCountries[i]] = 0; }
      for (var j=0;j<allReq.length;j++){
        var cn = allReq[j].country;
        if (cCounts.hasOwnProperty(cn)) cCounts[cn] += 1;
      }

      var term = countrySearch.value.toLowerCase();
      var filtered = [];
      for (var m=0;m<allCountries.length;m++){
        var name = allCountries[m];
        if (name.toLowerCase().indexOf(term) !== -1) filtered.push(name);
      }

      var limit = Math.min(filtered.length, visibleCountryCount);
      for (var n=0;n<limit;n++){
        var name2 = filtered[n];
        var li = document.createElement("li");
        li.innerHTML = '<a href="#">'+name2+'<span class="count">('+cCounts[name2]+')</span></a>';
        (function(countryName){
          li.addEventListener("click", function(){
            selectedCountry = countryName;
            visibleRequests = 15;
            renderRequests();
          });
        })(name2);
        countryList.appendChild(li);
      }
      showMoreCountriesBtn.style.display = filtered.length > visibleCountryCount ? "block" : "none";
    }

    function renderRequests(){
      var allReq = getRequests();

      // draw side lists (always visible with counts)
      renderCategories(allReq);
      renderCountries();

      var term = (searchInput.value || "").toLowerCase();

      var filtered = [];
      for (var i=0;i<allReq.length;i++){
        var r = allReq[i];
        var okTab = (activeTab === "all") || (r.type === activeTab);
        var okCat = (!selectedCategory) || (r.category === selectedCategory);
        var okCtry = (!selectedCountry) || (r.country === selectedCountry);
        var okText = (r.title && r.title.toLowerCase().indexOf(term) !== -1) ||
                     (r.description && r.description.toLowerCase().indexOf(term) !== -1);
        if (okTab && okCat && okCtry && okText){ filtered.push(r); }
      }

      requestContainer.innerHTML = "";
      var lim = Math.min(filtered.length, visibleRequests);
      for (var j=0;j<lim;j++){
        var rr = filtered[j];
        var card = document.createElement("div");
        card.className = "request-card";
        card.innerHTML =
          '<h5>'+ (rr.title || '') +'</h5>'+
          '<p>'+ (rr.description || '') +'</p>'+
          '<small>'+ (rr.country || 'Unknown') +' Â· '+ (rr.category || 'Uncategorized') +'</small>';
        (function(id){
          card.addEventListener("click", function(){
            window.location.href = "request-detail.html?id=" + encodeURIComponent(id);
          });
        })(rr.id);
        requestContainer.appendChild(card);
      }

      var showBtn = document.getElementById("showMoreRequests");
      showBtn.style.display = (filtered.length > visibleRequests) ? "block" : "none";
    }

    /* ---------- Events ---------- */
    document.getElementById("showMoreRequests").addEventListener("click", function(){
      visibleRequests += 10;
      renderRequests();
    });

    searchInput.addEventListener("input", function(){
      visibleRequests = 15;
      renderRequests();
    });

    tabs.all.addEventListener("click", function(){
      tabs.all.classList.add("active"); tabs.buy.classList.remove("active"); tabs.sell.classList.remove("active");
      activeTab = "all"; visibleRequests = 15; renderRequests();
    });
    tabs.buy.addEventListener("click", function(){
      tabs.buy.classList.add("active"); tabs.all.classList.remove("active"); tabs.sell.classList.remove("active");
      activeTab = "buy"; visibleRequests = 15; renderRequests();
    });
    tabs.sell.addEventListener("click", function(){
      tabs.sell.classList.add("active"); tabs.all.classList.remove("active"); tabs.buy.classList.remove("active");
      activeTab = "sell"; visibleRequests = 15; renderRequests();
    });

    showMoreCountriesBtn.addEventListener("click", function(){
      visibleCountryCount += 10;
      renderCountries();
    });
    countrySearch.addEventListener("input", function(){
      visibleCountryCount = 10;
      renderCountries();
    });

    document.getElementById("clearFilters").addEventListener("click", function(){
      selectedCategory = null;
      selectedCountry = null;
      searchInput.value = "";
      countrySearch.value = "";
      visibleRequests = 15;
      visibleCountryCount = 10;
      renderRequests();
    });

    /* ---------- Initial paint ---------- */
    renderRequests();
  </script>
</body>
</html>
