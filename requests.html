<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trader Route - Requests</title>

  <!-- ‚úÖ SEO -->
  <meta name="description" content="Explore global buy and sell requests on Trader Route. Filter by category and country to find real B2B trade opportunities." />
  <meta name="keywords" content="Trader Route, requests, buy, sell, B2B, global trade, marketplace, import, export" />
  <meta name="author" content="Trader Route" />
  <link rel="canonical" href="https://traderroute.com/requests.html" />

  <link rel="icon" href="assets/logos.png" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* === orijinal stiller korunuyor; yalnƒ±zca ye≈üil tema i√ßin k√º√ß√ºk eklemeler === */
    :root{
      --brand-green:#008b6a;
      --brand-dark:#006b52;
    }
    body {font-family:"Inter",Segoe UI,Arial,sans-serif;background:#f6f8fa;margin:0;color:#222;}
    header{display:flex;align-items:center;background:#fff;padding:12px 20px;border-bottom:1px solid #ddd;box-shadow:0 2px 4px rgba(0,0,0,0.05);}
    header img{height:54px;cursor:pointer;}
    .tabs{display:flex;justify-content:center;background:#fff;border-bottom:1px solid #ddd;gap:10px;padding:14px 0;}
    .tabs button{background:none;border:none;font-weight:600;font-size:17px;padding:10px 24px;border-radius:25px;cursor:pointer;transition:0.25s;color:#333;}
    .tabs button:hover{background:#f0f0f0;}
    /* aktif sekme rengi ye≈üil */
    .tabs button.active{background:var(--brand-green);color:#fff;}
    .container{max-width:1300px;margin:35px auto;display:flex;gap:24px;padding:0 15px;}
    .sidebar{width:300px;background:#fff;padding:22px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.06);display:flex;flex-direction:column;}
    .sidebar h4{font-size:19px;font-weight:700;color:#111;margin-bottom:10px;border-bottom:1px solid #eee;padding-bottom:4px;}
    .category-search,.country-search{width:100%;padding:9px;border:1px solid #ccc;border-radius:6px;margin-bottom:10px;font-size:14px;}
    .category-list,.country-list{list-style:none;padding-left:0;margin:0;overflow-y:auto;scrollbar-width:thin;scrollbar-color:#ccc transparent;flex:1;}
    .category-list{max-height:250px;margin-bottom:20px;}
    .country-list{max-height:300px;}
    .category-list li,.country-list li{margin-bottom:6px;}
    .category-list a,.country-list a{text-decoration:none;color:#333;display:flex;align-items:center;justify-content:space-between;font-size:14px;gap:6px;padding:4px 3px;border-radius:5px;transition:0.2s;}
    .category-list a:hover,.country-list a:hover{background:#f1f6ff;color:#007bff;}
    .count{color:#888;font-size:13px;}
    .flag{width:20px;height:14px;border:1px solid #ccc;border-radius:2px;margin-right:6px;object-fit:cover;}
    .content{flex:1;background:#fff;border-radius:12px;padding:30px;box-shadow:0 2px 6px rgba(0,0,0,0.06);}
    .search-bar{margin-bottom:20px;}
    #searchInput{width:100%;max-width:400px;padding:10px;border-radius:6px;border:1px solid #ccc;font-size:14px;}
    .request-card{border:1px solid #e3e3e3;border-radius:8px;padding:15px;margin-bottom:15px;background:#fff;transition:0.25s;cursor:pointer;}
    .request-card:hover{box-shadow:0 3px 10px rgba(0,0,0,0.08);transform:translateY(-2px);}
    .request-card h5{margin:0 0 6px;font-size:17px;font-weight:600;}
    .request-card p{margin:0 0 4px;font-size:14px;color:#444;}
    .request-card small{color:#666;}
    /* show more (requests) d√ºƒümesini ye≈üil yap */
    #showMoreRequests{background:var(--brand-green);color:#fff;border:none;border-radius:6px;padding:10px 15px;cursor:pointer;font-weight:600;margin:20px auto;display:block;transition:0.3s;}
    #showMoreRequests:hover{background:var(--brand-dark);}
    /* header‚Äôa JS ile eklenecek ye≈üil butonlar */
    .tr-btn{background:var(--brand-green);color:#fff;border:none;border-radius:24px;padding:8px 14px;font-weight:600;cursor:pointer;}
    .tr-btn:hover{background:var(--brand-dark);}
    .tr-right{display:flex;align-items:center;gap:10px;margin-left:auto;}
    .tr-search{background:#f1f1f1;border-radius:20px;padding:5px 10px;display:flex;align-items:center;}
    .tr-search input{border:none;background:none;outline:none;padding:5px;width:160px;}
    @media(max-width:900px){.container{flex-direction:column}.sidebar{width:100%;order:2}.content{order:1}}
  </style>
</head>

<body>
  <!-- === ORƒ∞Jƒ∞NAL HEADER BLOƒûU (sadece logo vardƒ±) === -->
  <header id="trHeader">
    <a href="index.html"><img src="assets/logos.png" alt="Trader Route Logo" /></a>
    <!-- üß© Men√º ve butonlar JS ile eklenecek (HTML yapƒ±sƒ±nƒ± ellemedim) -->
  </header>

  <!-- === ORƒ∞Jƒ∞NAL TABS (Free Request sekmesi JS ile eklenecek) === -->
  <div class="tabs" id="trTabs">
    <button class="active" id="tabAll">All Requests</button>
    <button id="tabBuy">Buy Requests</button>
    <button id="tabSell">Sell Requests</button>
  </div>

  <!-- === ORƒ∞Jƒ∞NAL SAYFA ƒ∞SKELETƒ∞ === -->
  <div class="container">
    <div class="sidebar">
      <h4>Categories</h4>
      <input type="text" class="category-search" id="categorySearch" placeholder="Search category..." />
      <ul class="category-list" id="categoryList"></ul>

      <h4>Countries</h4>
      <input type="text" class="country-search" id="countrySearch" placeholder="Search country..." />
      <ul class="country-list" id="countryList"></ul>
    </div>

    <div class="content">
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search requests..." />
      </div>
      <div id="requestItems"></div>
      <button id="showMoreRequests">Show more requests</button>
    </div>
  </div>

  <script>
    /* ======= ORƒ∞Jƒ∞NAL DEƒûƒ∞≈ûKENLER (gerekli olanlar) ======= */
    const getRequests = () => JSON.parse(localStorage.getItem("requests") || "[]");
    const requestContainer = document.getElementById("requestItems");
    const searchInput = document.getElementById("searchInput");
    const categoryList = document.getElementById("categoryList");
    const countryList = document.getElementById("countryList");
    const categorySearch = document.getElementById("categorySearch");
    const countrySearch = document.getElementById("countrySearch");

    let visibleRequests = 15;
    let activeTab = "all";
    let selectedCategory = null;
    let selectedCountry = new URLSearchParams(location.search).get("country") || null;

    /* ======= 1) HEADER EKLEMESƒ∞ (YAPISAL HTML'E DOKUNMADAN) ======= */
    (function enhanceHeader(){
      const hdr = document.getElementById('trHeader');
      // NAV
      const nav = document.createElement('nav');
      nav.style.marginLeft = '20px';
      nav.innerHTML = `
        <a href="index.html" style="margin:0 10px;text-decoration:none;color:#222;font-weight:600;">Home</a>
        <a href="companies.html" style="margin:0 10px;text-decoration:none;color:#222;font-weight:600;">Companies</a>
        <a href="requests.html" style="margin:0 10px;text-decoration:none;color:var(--brand-green);font-weight:700;">Requests</a>
        <a href="contact.html" style="margin:0 10px;text-decoration:none;color:#222;font-weight:600;">Contact</a>
        <a href="pricing.html" style="margin:0 10px;text-decoration:none;color:#222;font-weight:600;">Prices</a>
      `;
      hdr.appendChild(nav);
      // RIGHT SIDE
      const right = document.createElement('div');
      right.className = 'tr-right';
      right.innerHTML = `
        <div class="tr-search">
          <input type="text" id="hdrSearch" placeholder="Search..." />
          üîç
        </div>
        <button class="tr-btn" onclick="location.href='free-request.html'">Free Request</button>
        <button class="tr-btn" onclick="location.href='login.html'">Sign In</button>
        <button class="tr-btn" onclick="location.href='register.html'">Sign Up</button>
      `;
      hdr.appendChild(right);
    })();

    /* ======= 2) TABS: FREE REQUEST SEKME EKLE ======= */
    (function addFreeRequestTab(){
      const tabs = document.getElementById('trTabs');
      const btn = document.createElement('button');
      btn.textContent = 'Free Request';
      btn.onclick = () => location.href = 'free-request.html';
      tabs.appendChild(btn);
    })();

    /* ======= 3) JSON'DAN KATEGORƒ∞ & √úLKE Y√úKLE ======= */
    let categories = [];
    let countries = []; // normalized: {name, code}

    // Bazƒ± yaygƒ±n √ºlke adlarƒ± i√ßin ISO2 kod kestirmesi (fallback)
    const countryCodeMap = {
      "Turkey":"tr","United States":"us","Germany":"de","France":"fr","Italy":"it","Spain":"es","China":"cn","Japan":"jp",
      "India":"in","Brazil":"br","Russia":"ru","Canada":"ca","Australia":"au","United Kingdom":"gb","UK":"gb","Mexico":"mx"
    };

    async function loadCategories(){
      try{
        const res = await fetch('data/categories.json',{cache:'no-store'});
        const arr = await res.json();
        categories = Array.isArray(arr) ? arr.map(String) : [];
      }catch{ categories = []; }
    }

    async function loadCountries(){
      try{
        const res = await fetch('data/countries.json',{cache:'no-store'});
        const arr = await res.json();
        // arr: ["Turkey","United States",...]  veya [{name:"Turkey",code:"tr"},...]
        countries = (arr || []).map(it=>{
          if(typeof it === 'string'){
            const name = it;
            const code = (countryCodeMap[name] || name.slice(0,2)).toLowerCase();
            return {name, code};
          }else{
            return {name:String(it.name), code:String(it.code||'').toLowerCase() || (countryCodeMap[it.name]||it.name.slice(0,2)).toLowerCase()};
          }
        });
      }catch{ countries = []; }
    }

    /* ======= 4) SCROLL-Lƒ∞Mƒ∞T: ƒ∞LK 10, SONRASI A≈ûAƒûI KAYDIRDIK√áA Y√úKLE ======= */
    function makeInfiniteList({ulEl, items, renderItem, batch=20, first=10}){
      ulEl.innerHTML = '';
      let index = 0;
      function appendMore(){
        const end = Math.min(index + (index===0 ? first : batch), items.length);
        for(; index<end; index++){
          const li = document.createElement('li');
          li.appendChild(renderItem(items[index]));
          ulEl.appendChild(li);
        }
      }
      appendMore();
      ulEl.addEventListener('scroll', ()=>{
        if(ulEl.scrollTop + ulEl.clientHeight >= ulEl.scrollHeight - 4){
          appendMore();
        }
      });
      return ()=>{ index=0; appendMore(); }; // refresher
    }

    /* ======= 5) Lƒ∞STELERƒ∞ OLU≈ûTUR (COUNT'LAR KORUNUR) ======= */
    function renderCategories(requests){
      const term = categorySearch.value.toLowerCase();
      const data = categories.filter(c => c.toLowerCase().includes(term));
      const items = data.map(cat=>{
        const count = requests.filter(r => r.category === cat).length;
        const a = document.createElement('a');
        a.href = '#';
        a.innerHTML = `${cat}<span class="count">(${count})</span>`;
        a.addEventListener('click', (e)=>{ e.preventDefault(); selectedCategory = cat; selectedCountry = null; renderRequests(); });
        return a;
      });
      makeInfiniteList({ulEl: categoryList, items, renderItem:(node)=>node, first:10, batch:20});
    }

    function renderCountries(requests){
      const term = countrySearch.value.toLowerCase();
      const data = countries.filter(c => c.name.toLowerCase().includes(term));
      const items = data.map(c=>{
        const count = requests.filter(r => r.country === c.name).length;
        const a = document.createElement('a');
        a.href = '#';
        a.innerHTML = `<span style="display:flex;align-items:center;gap:6px;"><img class="flag" src="https://flagcdn.com/h20/${c.code}.png" alt="${c.name}" loading="lazy">${c.name}</span><span class="count">(${count})</span>`;
        a.addEventListener('click',(e)=>{ e.preventDefault(); window.location.href = \`requests.html?country=\${encodeURIComponent(c.name)}\`; });
        return a;
      });
      makeInfiniteList({ulEl: countryList, items, renderItem:(node)=>node, first:10, batch:30});
    }

    /* ======= 6) REQUEST KARTLARI: TIKLANINCA DETAY ======= */
    function renderRequests(){
      const allReq = getRequests();
      renderCategories(allReq);
      renderCountries(allReq);

      const term = (searchInput.value||'').toLowerCase();
      const filtered = allReq.filter(r =>
        (activeTab === "all" || r.type === activeTab) &&
        (!selectedCategory || r.category === selectedCategory) &&
        (!selectedCountry || r.country === selectedCountry) &&
        ((r.title||'').toLowerCase().includes(term) || (r.description||'').toLowerCase().includes(term))
      );

      requestContainer.innerHTML = '';
      const sliceCount = Math.min(filtered.length, visibleRequests);
      for(let i=0;i<sliceCount;i++){
        const r = filtered[i];
        const div = document.createElement('div');
        div.className = 'request-card';
        div.innerHTML = `<h5>${r.title}</h5><p>${r.description||''}</p><small>${r.country} ¬∑ ${r.category}</small>`;
        // ‚úÖ tƒ±klayƒ±nca detay
        div.onclick = ()=>{ window.location.href = \`request-detail.html?id=\${encodeURIComponent(r.id)}\`; };
        requestContainer.appendChild(div);
      }
      document.getElementById("showMoreRequests").style.display = filtered.length > visibleRequests ? "block" : "none";
    }

    /* ======= 7) ETKƒ∞LE≈ûƒ∞MLER ======= */
    document.getElementById("showMoreRequests").addEventListener("click", () => {
      visibleRequests += 10;
      renderRequests();
    });
    searchInput.addEventListener("input", renderRequests);
    categorySearch.addEventListener("input", renderRequests);
    countrySearch.addEventListener("input", renderRequests);

    ["tabAll","tabBuy","tabSell"].forEach(id=>{
      document.getElementById(id).addEventListener("click", e=>{
        document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
        e.target.classList.add("active");
        activeTab = id==="tabAll" ? "all" : id==="tabBuy" ? "buy" : "sell";
        renderRequests();
      });
    });

    /* ======= 8) BA≈ûLAT ======= */
    (async function init(){
      await Promise.all([loadCategories(), loadCountries()]);
      renderRequests();
    })();
  </script>
</body>
</html>
